{% extends "base.html" %}
{% block title %}Dashboard — RecruitFlow{% endblock %}
{% block breadcrumb %}Dashboard{% endblock %}

{% block topbar_actions %}
<a href="{% url 'candidates:csv_import' %}" class="btn btn-secondary d-inline-flex align-items-center gap-2">
  <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
  Upload CSV
</a>
<a href="{% url 'positions:create' %}" class="btn btn-primary d-inline-flex align-items-center gap-2 ms-2">
  <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
  New Position
</a>
{% endblock %}

{% block extra_css %}
<style>
  /* ── Period toggle tabs ─────────────────────────────────────── */
  .period-tabs {
    display: flex;
    background: var(--bg-page);
    border: 1px solid var(--border-default);
    border-radius: 8px;
    padding: 3px;
    gap: 2px;
  }
  .period-tab {
    padding: 4px 14px;
    border-radius: 5px;
    font-size: 0.78rem;
    font-weight: 600;
    color: var(--text-tertiary);
    text-decoration: none;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .period-tab:hover { color: var(--text-primary); }
  .period-tab.active {
    background: #ffffff;
    color: var(--text-primary);
    box-shadow: 0 1px 3px rgba(15,23,42,0.10);
  }

  /* ── Overview metric blocks ─────────────────────────────────── */
  .ov-metrics {
    display: flex;
    border-bottom: 1px solid var(--border-light);
    margin-bottom: 1.5rem;
    padding-bottom: 1.25rem;
  }
  .ov-metric {
    flex: 1;
    padding: 0 1.5rem;
    border-right: 1px solid var(--border-light);
  }
  .ov-metric:first-child { padding-left: 0; }
  .ov-metric:last-child  { border-right: none; }
  .ov-metric-label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.70rem;
    font-weight: 700;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    margin-bottom: 0.5rem;
  }
  .ov-metric-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .ov-metric-value {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1;
    letter-spacing: -0.04em;
    margin-bottom: 0.4rem;
    font-variant-numeric: tabular-nums;
  }
  .ov-metric-sub {
    font-size: 0.78rem;
    color: var(--text-muted);
    font-weight: 500;
  }

  /* ── Trend badges ───────────────────────────────────────────── */
  .trend-badge {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    font-size: 0.72rem;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 99px;
  }
  .trend-up   { background: rgba(16,185,129,0.10); color: #059669; }
  .trend-down { background: rgba(239,68,68,0.10);  color: #DC2626; }

  /* ── Pipeline ───────────────────────────────────────────────── */
  .pipeline-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.65rem;
  }
  .pipeline-row:last-child { margin-bottom: 0; }
  .pipeline-label {
    width: 88px;
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    flex-shrink: 0;
  }
  .pipeline-track {
    flex: 1;
    height: 6px;
    background: var(--border-default);
    border-radius: 99px;
    overflow: hidden;
  }
  .pipeline-bar {
    height: 100%;
    border-radius: 99px;
    transition: width 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .pipeline-count {
    width: 30px;
    text-align: right;
    font-size: 0.85rem;
    color: var(--text-primary);
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    flex-shrink: 0;
  }

  /* ── Needs-Attention list rows ──────────────────────────────────── */
  .attn-row {
    display: flex;
    align-items: center;
    gap: 0.85rem;
    padding: 0.8rem 1.25rem;
    border-bottom: 1px solid var(--border-light);
    transition: background 0.12s;
    color: var(--text-primary);
  }
  .attn-row:last-child { border-bottom: none; }
  .attn-row:hover { background: var(--bg-page); }
  .attn-row-icon {
    width: 34px;
    height: 34px;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .attn-icon-danger  { background: rgba(239,68,68,0.09);  color: #DC2626; }
  .attn-icon-warning { background: rgba(245,158,11,0.09); color: #D97706; }
  .attn-icon-info    { background: rgba(79,70,229,0.09);  color: #4F46E5; }
  .attn-row-body { flex: 1; min-width: 0; }
  .attn-row-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.3;
  }
  .attn-row-sub {
    font-size: 0.76rem;
    color: var(--text-muted);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .attn-badge {
    font-size: 0.72rem;
    font-weight: 700;
    padding: 2px 9px;
    border-radius: 99px;
    flex-shrink: 0;
    font-variant-numeric: tabular-nums;
  }
  .attn-badge-danger  { background: var(--status-rejected-bg);  color: var(--status-rejected-text);  }
  .attn-badge-warning { background: var(--status-screening-bg); color: var(--status-screening-text); }
  .attn-badge-info    { background: var(--status-review-bg);    color: var(--status-review-text);    }
  .attn-arrow {
    color: var(--text-muted);
    flex-shrink: 0;
    transition: color 0.12s, transform 0.12s;
  }
  .attn-row:hover .attn-arrow {
    color: var(--accent-primary);
    transform: translateX(2px);
  }
</style>
{% endblock %}

{% block content %}

{# ── Activity Overview card ──────────────────────────────────────── #}
<div class="card mb-4">
  <div class="card-header">
    <h2 class="card-header-title">Activity Overview</h2>
    <div class="period-tabs">
      <a href="?period=7"  class="period-tab {% if period == 7  %}active{% endif %}">7 days</a>
      <a href="?period=14" class="period-tab {% if period == 14 %}active{% endif %}">14 days</a>
      <a href="?period=30" class="period-tab {% if period == 30 %}active{% endif %}">30 days</a>
    </div>
  </div>
  <div class="card-body" style="padding: 1.5rem 1.5rem 1.25rem;">

    {# KPI metrics row #}
    <div class="ov-metrics">

      {# Calls #}
      <div class="ov-metric">
        <div class="ov-metric-label">
          <div class="ov-metric-dot" style="background:#4F46E5;"></div>
          Calls
        </div>
        <div class="ov-metric-value">{{ kpi_totals.calls }}</div>
        {% if kpi_totals.calls_trend %}
        <span class="trend-badge {% if kpi_totals.calls_trend.up %}trend-up{% else %}trend-down{% endif %}">
          {% if kpi_totals.calls_trend.up %}↑{% else %}↓{% endif %} {{ kpi_totals.calls_trend.pct }}%
        </span>
        {% else %}
        <span class="ov-metric-sub">No prior data</span>
        {% endif %}
      </div>

      {# CVs Received #}
      <div class="ov-metric">
        <div class="ov-metric-label">
          <div class="ov-metric-dot" style="background:#10B981;"></div>
          CVs Received
        </div>
        <div class="ov-metric-value">{{ kpi_totals.cvs }}</div>
        {% if kpi_totals.cvs_trend %}
        <span class="trend-badge {% if kpi_totals.cvs_trend.up %}trend-up{% else %}trend-down{% endif %}">
          {% if kpi_totals.cvs_trend.up %}↑{% else %}↓{% endif %} {{ kpi_totals.cvs_trend.pct }}%
        </span>
        {% else %}
        <span class="ov-metric-sub">No prior data</span>
        {% endif %}
      </div>

      {# Follow-ups #}
      <div class="ov-metric">
        <div class="ov-metric-label">
          <div class="ov-metric-dot" style="background:#8B5CF6;"></div>
          Follow-ups
        </div>
        <div class="ov-metric-value">{{ kpi_totals.followups }}</div>
        {% if kpi_totals.followups_trend %}
        <span class="trend-badge {% if kpi_totals.followups_trend.up %}trend-up{% else %}trend-down{% endif %}">
          {% if kpi_totals.followups_trend.up %}↑{% else %}↓{% endif %} {{ kpi_totals.followups_trend.pct }}%
        </span>
        {% else %}
        <span class="ov-metric-sub">No prior data</span>
        {% endif %}
      </div>

      {# Open Positions #}
      <div class="ov-metric">
        <div class="ov-metric-label">Open Positions</div>
        <div class="ov-metric-value">{{ position_summaries|length }}</div>
        <span class="ov-metric-sub">Currently active</span>
      </div>

    </div>{# /ov-metrics #}

    {# Chart #}
    {{ positions_chart_data|json_script:"dashboard-chart-data" }}
    <div style="position:relative; height:220px;">
      <canvas id="activity-chart"></canvas>
    </div>

  </div>
</div>

{# ── Lower 2-column layout ─────────────────────────────────────── #}
<div class="row g-3">

  {# Left: Active Positions + Needs Attention #}
  <div class="col-lg-8">

    <div class="card">
      <div class="card-header">
        <h2 class="card-header-title">Active Positions</h2>
        <a href="{% url 'positions:list' %}" class="view-all-link">View all &rarr;</a>
      </div>

      {% if position_summaries %}
      <div class="table-responsive">
        <table class="table mb-0">
          <thead>
            <tr>
              <th>Position</th>
              <th>Pending</th>
              <th>In Progress</th>
              <th>Awaiting CV</th>
              <th>Completed</th>
            </tr>
          </thead>
          <tbody>
            {% url 'applications:list' as apps_list_url %}
            {% for s in position_summaries %}
            <tr data-href="{{ apps_list_url }}?position={{ s.position.pk }}" style="cursor:pointer;">
              <td>
                <span class="fw-medium">{{ s.position.title }}</span>
                <div class="text-xs text-muted-custom mt-1">{{ s.total }} total</div>
              </td>
              <td>
                {% if s.pending_calls %}<div class="badge status-screening"><span class="badge-dot"></span> {{ s.pending_calls }}</div>{% else %}<span class="text-muted-custom">—</span>{% endif %}
              </td>
              <td>
                {% if s.in_progress %}<div class="badge status-interview"><span class="badge-dot"></span> {{ s.in_progress }}</div>{% else %}<span class="text-muted-custom">—</span>{% endif %}
              </td>
              <td>
                {% if s.awaiting_cv %}<div class="badge status-review"><span class="badge-dot"></span> {{ s.awaiting_cv }}</div>{% else %}<span class="text-muted-custom">—</span>{% endif %}
              </td>
              <td>
                {% if s.completed %}<div class="badge status-offered"><span class="badge-dot"></span> {{ s.completed }}</div>{% else %}<span class="text-muted-custom">—</span>{% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="card-body text-center py-5">
        <div class="empty-state-icon mx-auto mb-3">
          <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
        </div>
        <div class="empty-state-title">No open positions</div>
        <div class="empty-state-desc">Create a position to start tracking candidates.</div>
        <a href="{% url 'positions:create' %}" class="btn btn-secondary btn-sm">Create Position</a>
      </div>
      {% endif %}
    </div>

    {# Needs Attention card #}
    {% with a=attention_required %}
    {% if a.call_failures or a.cv_overdue or a.needs_human or a.callbacks_today or a.unmatched_inbound or a.needs_review_cvs %}
    <div class="card mt-3">
      <div class="card-header">
        <div class="d-flex align-items-center gap-2">
          <div style="width:7px;height:7px;border-radius:50%;background:var(--accent-negative);flex-shrink:0;box-shadow:0 0 0 2px rgba(239,68,68,0.18);"></div>
          <h2 class="card-header-title">Needs Attention</h2>
        </div>
      </div>

      {% if a.call_failures %}
      <a href="{% url 'applications:list' %}?status=call_failed" class="text-decoration-none">
        <div class="attn-row">
          <div class="attn-row-icon attn-icon-danger">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
          </div>
          <div class="attn-row-body">
            <div class="attn-row-title">Call Failures</div>
            <div class="attn-row-sub">Calls that failed and need retry</div>
          </div>
          <span class="attn-badge attn-badge-danger">{{ a.call_failures }}</span>
          <svg class="attn-arrow" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </div>
      </a>
      {% endif %}

      {% if a.cv_overdue %}
      <a href="{% url 'applications:list' %}?status=cv_overdue" class="text-decoration-none">
        <div class="attn-row">
          <div class="attn-row-icon attn-icon-warning">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          </div>
          <div class="attn-row-body">
            <div class="attn-row-title">CV Overdue</div>
            <div class="attn-row-sub">Candidates awaiting CV past deadline</div>
          </div>
          <span class="attn-badge attn-badge-warning">{{ a.cv_overdue }}</span>
          <svg class="attn-arrow" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </div>
      </a>
      {% endif %}

      {% if a.callbacks_today %}
      <a href="{% url 'applications:list' %}?status=callback_scheduled" class="text-decoration-none">
        <div class="attn-row">
          <div class="attn-row-icon attn-icon-info">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
          </div>
          <div class="attn-row-body">
            <div class="attn-row-title">Callbacks Today</div>
            <div class="attn-row-sub">Scheduled callbacks due today</div>
          </div>
          <span class="attn-badge attn-badge-info">{{ a.callbacks_today }}</span>
          <svg class="attn-arrow" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </div>
      </a>
      {% endif %}

      {% if a.needs_review_cvs %}
      <a href="{% url 'cvs:inbox' %}" class="text-decoration-none">
        <div class="attn-row">
          <div class="attn-row-icon attn-icon-warning">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
          </div>
          <div class="attn-row-body">
            <div class="attn-row-title">CVs Need Review</div>
            <div class="attn-row-sub">CVs received that need manual review</div>
          </div>
          <span class="attn-badge attn-badge-warning">{{ a.needs_review_cvs }}</span>
          <svg class="attn-arrow" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </div>
      </a>
      {% endif %}

      {% if a.needs_human %}
      <a href="{% url 'applications:list' %}?needs_human=1" class="text-decoration-none">
        <div class="attn-row">
          <div class="attn-row-icon attn-icon-info">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
          </div>
          <div class="attn-row-body">
            <div class="attn-row-title">Needs Human Review</div>
            <div class="attn-row-sub">Applications requiring human intervention</div>
          </div>
          <span class="attn-badge attn-badge-info">{{ a.needs_human }}</span>
          <svg class="attn-arrow" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </div>
      </a>
      {% endif %}

      {% if a.unmatched_inbound %}
      <a href="{% url 'cvs:inbox' %}" class="text-decoration-none">
        <div class="attn-row">
          <div class="attn-row-icon attn-icon-warning">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
          </div>
          <div class="attn-row-body">
            <div class="attn-row-title">Unmatched Inbound</div>
            <div class="attn-row-sub">Messages that couldn't be matched to a candidate</div>
          </div>
          <span class="attn-badge attn-badge-warning">{{ a.unmatched_inbound }}</span>
          <svg class="attn-arrow" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </div>
      </a>
      {% endif %}

    </div>{# /card #}
    {% endif %}
    {% endwith %}

  </div>{# /col-lg-8 #}

  {# Right: Pipeline + Recent Activity #}
  <div class="col-lg-4">

    <div class="card mb-3">
      <div class="card-header">
        <h2 class="card-header-title">Pipeline</h2>
      </div>
      <div class="card-body" style="padding:1.25rem;">
        {% for stage in pipeline_data %}
        <div class="pipeline-row">
          <div class="pipeline-label">{{ stage.label }}</div>
          <div class="pipeline-track"><div class="pipeline-bar" style="width:{{ stage.pct }}%;background:{{ stage.color }};"></div></div>
          <div class="pipeline-count">{{ stage.count }}</div>
        </div>
        {% empty %}
        <div class="text-sm text-tertiary text-center py-3">No applications yet.</div>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h2 class="card-header-title">Recent Activity</h2>
        <a href="{% url 'applications:list' %}" class="view-all-link">View all &rarr;</a>
      </div>
      {% if recent_changes %}
      <div class="activity-list py-2">
        {% for sc in recent_changes %}
        <a href="{% url 'applications:detail' sc.application.pk %}" class="text-decoration-none">
          <div class="activity-row">
            <div class="activity-dot-col">
              <div class="activity-dot"></div>
              {% if not forloop.last %}<div class="activity-connector"></div>{% endif %}
            </div>
            <div class="activity-body">
              <div class="activity-who">
                <strong>{{ sc.application.candidate.full_name }}</strong>
                &rarr; {{ sc.get_to_status_display }}
              </div>
              <div class="activity-sub">{{ sc.application.position.title }} &middot; {{ sc.changed_at|date:"d M H:i" }}</div>
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
      {% else %}
      <div class="card-body text-center py-4">
        <div class="text-sm text-tertiary">No recent activity.</div>
      </div>
      {% endif %}
    </div>

  </div>{# /col-lg-4 #}

</div>{# /row #}

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script>
(function () {
  var dataEl = document.getElementById('dashboard-chart-data');
  var canvas  = document.getElementById('activity-chart');
  if (!dataEl || !canvas) return;

  var raw = JSON.parse(dataEl.textContent);
  var labels = raw.labels.map(function(l) { return l.length > 22 ? l.slice(0, 20) + '…' : l; });
  var notQualified = raw.applications.map(function(t, i) { return t - raw.qualified[i]; });

  new Chart(canvas, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Other',
          data: notQualified,
          backgroundColor: 'rgba(79,70,229,0.45)',
          borderRadius: 0,
          borderSkipped: false,
          stack: 'pos',
        },
        {
          label: 'Qualified',
          data: raw.qualified,
          backgroundColor: 'rgba(16,185,129,0.80)',
          borderRadius: 4,
          borderSkipped: false,
          stack: 'pos',
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'top',
          align: 'end',
          labels: {
            color: '#94A3B8',
            font: { size: 11, weight: '600', family: "'DM Sans', sans-serif" },
            boxWidth: 10,
            boxHeight: 10,
            borderRadius: 3,
            useBorderRadius: true,
            padding: 16,
          },
        },
        tooltip: {
          mode: 'index',
          intersect: false,
          backgroundColor: '#ffffff',
          titleColor: '#0F172A',
          bodyColor: '#334155',
          borderColor: '#E2E8F0',
          borderWidth: 1,
          padding: 12,
          boxPadding: 4,
          titleFont: { family: "'DM Sans', sans-serif", weight: '700', size: 12 },
          bodyFont: { family: "'DM Sans', sans-serif", size: 12 },
          callbacks: {
            title: function(items) { return raw.labels[items[0].dataIndex]; },
            afterBody: function(items) { return ['Total: ' + raw.applications[items[0].dataIndex]]; },
          },
        },
      },
      scales: {
        x: {
          stacked: true,
          grid: { display: false },
          border: { display: false },
          ticks: { font: { size: 11, family: "'DM Sans', sans-serif" }, color: '#94A3B8' },
        },
        y: {
          stacked: true,
          beginAtZero: true,
          grid: { color: '#F1F5F9', drawBorder: false },
          border: { display: false },
          ticks: { precision: 0, font: { size: 11, family: "'DM Sans', sans-serif" }, color: '#94A3B8', padding: 8 },
        },
      },
    },
  });
})();
</script>
{% endblock %}
