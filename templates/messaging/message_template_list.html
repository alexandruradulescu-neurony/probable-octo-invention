{% extends "base.html" %}
{% block title %}Message Templates â€” RecruitFlow{% endblock %}
{% block breadcrumb %}<span class="bc-section">Configure</span><span class="bc-sep">/</span><span class="bc-page">Message Templates</span>{% endblock %}

{% block content %}

<!-- Tab navigation -->
<div class="d-flex gap-2 mb-4">
  <a href="{% url 'prompts:list' %}"
     class="btn btn-secondary d-inline-flex align-items-center gap-2">
    <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
      <polyline points="16 18 22 12 16 6"></polyline>
      <polyline points="8 6 2 12 8 18"></polyline>
    </svg>
    AI Prompts
  </a>
  <a href="{% url 'messaging:template_list' %}"
     class="btn btn-primary d-inline-flex align-items-center gap-2">
    <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
      <polyline points="22,6 12,13 2,6"></polyline>
    </svg>
    Message Templates
  </a>
</div>

{% if templates %}

<div class="card mb-0">
{% for type_label, group in grouped.items %}
<div class="border-bottom" style="border-color:var(--border-default)!important;">
  <div class="card-header" style="border-bottom:none;">
    <h2 class="card-header-title">{{ type_label }}</h2>
  </div>
  <div class="table-responsive">
    <table class="table mb-0">
      <thead>
        <tr>
          <th>Channel</th>
          <th>Subject</th>
          <th>Preview</th>
          <th class="text-center">Active</th>
          <th>Updated</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for tpl in group %}
        <tr>
          <td>
            {% if tpl.channel == "whatsapp" %}
            <div class="d-flex align-items-center gap-2 text-sm fw-medium" style="color:var(--accent-positive);">
              <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
              </svg>
              WhatsApp
            </div>
            {% else %}
            <div class="d-flex align-items-center gap-2 text-sm fw-medium text-secondary">
              <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                <polyline points="22,6 12,13 2,6"></polyline>
              </svg>
              Email
            </div>
            {% endif %}
          </td>
          <td class="text-sm">
            {% if tpl.subject %}
              <span class="text-secondary">{{ tpl.subject|truncatechars:50 }}</span>
            {% else %}
              <span class="text-muted-custom">&mdash;</span>
            {% endif %}
          </td>
          <td style="max-width:360px;" class="text-xs text-muted-custom">
            {{ tpl.body|truncatechars:110 }}
          </td>
          <td class="text-center">
            {% if tpl.is_active %}
            <div class="badge status-offered"><span class="badge-dot"></span> Active</div>
            {% else %}
            <span class="text-muted-custom text-xs">&mdash;</span>
            {% endif %}
          </td>
          <td class="text-xs text-muted-custom tabular-nums">
            {{ tpl.updated_at|date:"M j, Y H:i" }}
          </td>
          <td class="text-end">
            <a href="{% url 'messaging:template_edit' tpl.pk %}"
               class="btn btn-secondary btn-sm">Edit</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endfor %}
{% include "partials/pagination.html" %}
</div>

{% else %}
<div class="card">
  <div class="card-body text-center py-5">
    <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="1.5"
         stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"
         style="color:var(--text-muted);margin-bottom:12px;">
      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
      <polyline points="22,6 12,13 2,6"></polyline>
    </svg>
    <div class="text-sm text-tertiary mb-2">No message templates found.</div>
    <div class="text-xs text-muted-custom">
      Run <code class="code-inline">python manage.py seed_message_templates</code>
      to generate the default set.
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
